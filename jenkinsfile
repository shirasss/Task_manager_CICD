pipeline {
    agent any
    environment {
        artifactRegistryImage = "me-west1-docker.pkg.dev/eco-tract-407114/shira-repo/chat_sql"
    }
    stages {
        stage('Build') {
            steps {
                echo 'Building the Docker image'
                    script {
                        // Extract the commit hash
                        def commitHash = sh(script: 'git rev-parse HEAD', returnStdout: true).trim()
                        // Build the Docker image with the commit hash as the version tag
                        // sh "docker build -t $artifactRegistryImage:$commitHash ./python/"
                        // sh "gcloud auth configure-docker me-west1-docker.pkg.dev"
                        // sh "docker push $artifactRegistryImage:$commitHash"
                        echo 'Stopping and removing containers...'
                        sh "docker-compose stop"
                        sh "docker-compose down"
                        sleep time: 30, unit: 'SECONDS'  // Adjust the delay time as needed
                        sh "docker-compose up --build -d"
                        sleep time: 30, unit: 'SECONDS'  // Adjust the delay time as needed
                    }
                
            }
        }

    }
}

